<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSS-in-TS Playground</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      height: 100vh;
      overflow: hidden;
    }

    .header {
      background: #1e293b;
      padding: 1rem 2rem;
      border-bottom: 1px solid #334155;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #60a5fa;
    }

    .header .subtitle {
      font-size: 0.875rem;
      color: #94a3b8;
      margin-left: 1rem;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      height: calc(100vh - 65px);
    }

    .panel {
      display: flex;
      flex-direction: column;
      border-right: 1px solid #334155;
    }

    .panel:last-child {
      border-right: none;
    }

    .panel-header {
      background: #1e293b;
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: #94a3b8;
      border-bottom: 1px solid #334155;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-header .badge {
      background: #334155;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
    }

    .editor-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    #code-editor {
      width: 100%;
      height: 100%;
      background: #0f172a;
      color: #e2e8f0;
      border: none;
      padding: 1rem;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: none;
      outline: none;
    }

    .output-container {
      flex: 1;
      overflow: auto;
      background: #0f172a;
    }

    .output-section {
      padding: 1rem;
      border-bottom: 1px solid #334155;
    }

    .output-section:last-child {
      border-bottom: none;
    }

    .output-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .output-content {
      background: #1e293b;
      padding: 1rem;
      border-radius: 0.5rem;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
      font-size: 13px;
      line-height: 1.6;
      color: #e2e8f0;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 200px;
      overflow: auto;
    }

    .preview-box {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .error {
      background: #7f1d1d;
      border: 1px solid #dc2626;
      color: #fca5a5;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem;
    }

    .copy-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .copy-btn:hover {
      background: #2563eb;
    }

    .copy-btn:active {
      background: #1d4ed8;
    }

    .example-btn {
      background: #334155;
      color: #94a3b8;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .example-btn:hover {
      background: #475569;
      color: #e2e8f0;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        grid-template-rows: 1fr 1fr;
      }

      .panel {
        border-right: none;
        border-bottom: 1px solid #334155;
      }

      .panel:last-child {
        border-bottom: none;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div style="display: flex; align-items: center;">
      <h1>CSS-in-TS</h1>
      <span class="subtitle">Playground</span>
    </div>
    <div style="display: flex; gap: 1rem; align-items: center;">
      <button class="example-btn" onclick="loadExample('button')">Button</button>
      <button class="example-btn" onclick="loadExample('card')">Card</button>
      <button class="example-btn" onclick="loadExample('responsive')">Responsive</button>
      <div style="font-size: 0.875rem; color: #94a3b8;">
        Hash-based • Compile-time • Type-safe
      </div>
    </div>
  </div>

  <div class="container">
    <div class="panel">
      <div class="panel-header">
        <span>TypeScript Code</span>
        <span class="badge">Input</span>
      </div>
      <div class="editor-container">
        <textarea id="code-editor" spellcheck="false"></textarea>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <span>Compilation Results</span>
        <span class="badge">Output</span>
      </div>
      <div class="output-container">
        <div class="output-section">
          <div class="output-title">
            Generated CSS
            <button class="copy-btn" onclick="copyCSS()">Copy</button>
          </div>
          <div id="css-output" class="output-content"></div>
        </div>

        <div class="output-section">
          <div class="output-title">
            Class Names
            <button class="copy-btn" onclick="copyClasses()">Copy</button>
          </div>
          <div id="classes-output" class="output-content"></div>
        </div>

        <div class="output-section">
          <div class="output-title">Live Preview</div>
          <div id="preview" class="preview-box"></div>
        </div>

        <div id="error-output"></div>
      </div>
    </div>
  </div>

  <style id="preview-styles"></style>

  <script type="module">
    import { style, cx, generateCSS, setFileScope, clearRegistry } from '../src/index.ts';
    import { createSizes, createMedia } from '../src/index.ts';
    import * as utilities from '../src/index.ts';

    const codeEditor = document.getElementById('code-editor');
    const cssOutput = document.getElementById('css-output');
    const classesOutput = document.getElementById('classes-output');
    const preview = document.getElementById('preview');
    const errorOutput = document.getElementById('error-output');
    const previewStyles = document.getElementById('preview-styles');

    const { p, px, text, rounded } = createSizes();
    const { sm, md, lg } = createMedia({
      sm: 'screen and (min-width: 640px)',
      md: 'screen and (min-width: 768px)',
      lg: 'screen and (min-width: 1024px)',
    });

    // Example codes
    const examples = {
      button: `// Button component
const button = style('button', {
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  padding: '0.75rem 1.5rem',
  backgroundColor: '#3b82f6',
  color: 'white',
  borderRadius: '0.25rem',
  fontWeight: 'bold',
  cursor: 'pointer',
  transition: 'all 150ms ease-in-out',
  '&:hover': {
    backgroundColor: '#2563eb',
    transform: 'scale(1.05)',
  },
  '&:active': {
    transform: 'scale(0.98)',
  },
});

console.log(button);`,

      card: `// Card component
const card = style('card', {
  display: 'flex',
  flexDirection: 'column',
  padding: '1rem',
  backgroundColor: 'white',
  borderRadius: '0.5rem',
  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)',
  gap: '0.5rem',
});

const heading = cx(
  text(6),
  utilities.fontBold(),
  utilities.textCol('#1f2937')
);

console.log(card);
console.log(heading);`,

      responsive: `// Responsive utilities
const responsive = cx(
  p(2),
  sm(p(4)),
  md(p(6)),
  lg(p(8))
);

const container = style('container', {
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  gap: '1rem',
  padding: '1rem',
  backgroundColor: '#f8fafc',
  borderRadius: '0.5rem',
});

console.log(responsive);
console.log(container);`
    };

    codeEditor.value = examples.button;

    // Load example
    window.loadExample = (name) => {
      codeEditor.value = examples[name];
      compile();
    };

    // Compile and render
    function compile() {
      try {
        clearRegistry();
        setFileScope('/playground.ts');

        // Reset outputs
        cssOutput.textContent = '';
        classesOutput.textContent = '';
        preview.innerHTML = '';
        errorOutput.innerHTML = '';
        previewStyles.textContent = '';

        // Capture console.log
        const logs = [];
        const originalLog = console.log;
        console.log = (...args) => {
          logs.push(args);
        };

        // Execute the code
        Function(codeEditor.value)();

        // Restore console.log
        console.log = originalLog;

        // Generate CSS
        const css = generateCSS();
        cssOutput.textContent = css;
        previewStyles.textContent = css;

        // Extract class names from logs
        const classNames = logs
          .flat()
          .filter(arg => typeof arg === 'string' && (arg.includes('__') || arg.startsWith('x')))
          .join('\n');
        classesOutput.textContent = classNames || 'No class names generated';

        // Create preview elements based on logs
        logs.forEach((log) => {
          const className = log[0];
          if (typeof className === 'string' && className.includes('__')) {
            // Determine element type based on class name
            if (className.includes('button')) {
              const btn = document.createElement('button');
              btn.className = className;
              btn.textContent = 'Button';
              preview.appendChild(btn);
            } else if (className.includes('card')) {
              const card = document.createElement('div');
              card.className = className;
              card.innerHTML = '<h3 style="margin:0">Card</h3><p style="margin:0.5rem 0 0 0">Card content</p>';
              preview.appendChild(card);
            } else if (className.includes('container')) {
              const container = document.createElement('div');
              container.className = className;
              container.innerHTML = '<span>Container</span>';
              preview.appendChild(container);
            } else {
              const el = document.createElement('div');
              el.className = className;
              el.style.margin = '0.5rem';
              el.textContent = className;
              preview.appendChild(el);
            }
          }
        });

      } catch (error) {
        errorOutput.innerHTML = `<div class="error"><strong>Error:</strong><br>${error.message}</div>`;
        console.error(error);
      }
    }

    // Compile on input with debounce
    let debounceTimer;
    codeEditor.addEventListener('input', () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(compile, 500);
    });

    // Initial compile
    compile();

    // Copy functions
    window.copyCSS = () => {
      navigator.clipboard.writeText(cssOutput.textContent);
      alert('CSS copied to clipboard!');
    };

    window.copyClasses = () => {
      navigator.clipboard.writeText(classesOutput.textContent);
      alert('Class names copied to clipboard!');
    };
  </script>
</body>
</html>
